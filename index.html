<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØªØ¨Ø¹ Ø±Ø­Ù„Ø© Ø§Ù„ØªÙˆØ¨Ø© ÙˆØ§Ù„ØªØºÙŠÙŠØ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #e0f2f7 0%, #cce7f5 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            overflow-x: hidden;
        }
        .container {
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            padding: 45px;
            width: 100%;
            max-width: 850px;
            text-align: center;
            direction: rtl;
            position: relative;
            z-index: 10;
            overflow: hidden;
            animation: fadeInScale 0.8s ease-out forwards;
        }
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        input[type="number"], input[type="text"] {
            border: 2px solid #a7d9f7;
            border-radius: 12px;
            padding: 14px 20px;
            width: calc(100% - 40px);
            margin-bottom: 25px;
            font-size: 1.25rem;
            transition: border-color 0.4s ease, box-shadow 0.4s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            text-align: right; /* Align text to the right for Arabic input */
        }
        input[type="number"]:focus, input[type="text"]:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.2);
        }
        button {
            background-image: linear-gradient(45deg, #4CAF50 0%, #8BC34A 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.25rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
            position: relative;
            overflow: hidden;
            border: none;
        }
        button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 25px rgba(76, 175, 80, 0.6);
        }
        button:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }
        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            opacity: 0;
            transform: scale(1) translate(-50%, -50%);
            transition: width 0.5s ease-out, height 0.5s ease-out, opacity 0.5s ease-out;
        }
        button:active::after {
            width: 200%;
            height: 200%;
            opacity: 1;
            transition: 0s;
        }

        .info-section {
            background-color: #f0f8ff;
            border: 1px solid #b3e0ff;
            border-radius: 16px;
            padding: 25px;
            margin-top: 30px;
            text-align: right;
            transition: all 0.5s ease-out;
            opacity: 0;
            transform: translateY(20px);
        }
        .info-section.loaded {
            opacity: 1;
            transform: translateY(0);
        }
        .info-section h2 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 2px solid #b3e0ff;
            padding-bottom: 12px;
        }
        .info-section p {
            font-size: 1.15rem;
            line-height: 1.8;
            color: #5d748f;
        }
        .loading-spinner {
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-top: 5px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
            margin: 30px auto;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Modal styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.4s ease-out;
        }
        .modal.show {
            visibility: visible;
            opacity: 1;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 35px;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            max-width: 450px;
            text-align: center;
            position: relative;
            transform: translateY(-30px) scale(0.9);
            transition: transform 0.4s ease-out, opacity 0.4s ease-out;
            opacity: 0;
        }
        .modal.show .modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
        .modal-content h3 {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 700;
        }
        .modal-content p {
            font-size: 1.2rem;
            color: #5d748f;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .modal-content button {
            background-color: #ef5350;
            background-image: linear-gradient(45deg, #ef5350 0%, #e57370 100%);
            box-shadow: 0 4px 15px rgba(239, 83, 80, 0.3);
        }
        .modal-content button:hover {
            background-color: #e53935;
            box-shadow: 0 6px 20px rgba(239, 83, 80, 0.4);
        }

        /* AI Help Modal specific styles */
        #aiHelpModal .modal-content {
            max-width: 600px;
            text-align: right;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        #aiHelpModal .modal-content h3 {
            text-align: center;
        }
        #aiHelpModal .advice-display {
            background-color: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 1.2rem;
            color: #1976d2;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.6;
            transition: all 0.3s ease-out;
            opacity: 0;
            transform: scale(0.95);
        }
        #aiHelpModal .advice-display.show-advice {
            opacity: 1;
            transform: scale(1);
        }
        #aiHelpModal .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
        }
        #aiHelpModal .button-group button {
            padding: 12px 25px;
            font-size: 1.1rem;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        #aiHelpModal #nextAdviceButton {
            background-image: linear-gradient(45deg, #2196F3 0%, #03A9F4 100%);
        }
        #aiHelpModal #nextAdviceButton:hover {
            background-image: linear-gradient(45deg, #1976D2 0%, #0288D1 100%);
            transform: translateY(-2px);
        }
        #aiHelpModal #revealAiChatButton {
            background-image: linear-gradient(45deg, #FFC107 0%, #FFEB3B 100%);
            color: #333;
        }
        #aiHelpModal #revealAiChatButton:hover {
            background-image: linear-gradient(45deg, #FFA000 0%, #FFC107 100%);
            color: #333;
            transform: translateY(-2px);
        }

        #aiHelpModal .ai-question-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }
        #aiHelpModal .ai-question-section.show {
            display: block;
            opacity: 1;
        }
        #aiHelpModal .ai-question-section textarea {
            width: 100%;
            border: 2px solid #a7d9f7;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 1rem;
            min-height: 80px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        #aiHelpModal .ai-question-section textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }
        #aiHelpModal .ai-response {
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: right;
            font-size: 1.1rem;
            color: #388e3c;
            line-height: 1.6;
        }
        #aiHelpModal .math-problem {
            font-size: 1.3rem;
            font-weight: bold;
            color: #0d47a1;
            margin-top: 10px;
            margin-bottom: 10px;
            background-color: #e0f7fa;
            padding: 10px;
            border-radius: 8px;
            border: 1px dashed #00bcd4;
        }
        #aiHelpModal .modal-close-button {
            background-image: linear-gradient(45deg, #ef5350 0%, #e57370 100%);
            margin-top: 25px;
            width: auto;
            padding: 12px 25px;
        }

        /* Commitment Modal specific styles */
        #commitmentSection .modal-content { /* Changed from .modal to #commitmentSection */
            max-width: 550px;
            text-align: center;
        }
        #commitmentSection .modal-content button {
            background-image: linear-gradient(45deg, #28a745 0%, #218838 100%);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        #commitmentSection .modal-content button:hover {
            background-image: linear-gradient(45deg, #218838 0%, #1e7e34 100%);
        }

        /* New sections for initial flow */
        .full-screen-section {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e0f2f7 0%, #cce7f5 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
        }
        .full-screen-section.show {
            opacity: 1;
            visibility: visible;
        }
        .full-screen-section .content-box {
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            padding: 45px;
            max-width: 700px;
            width: 100%;
        }
        .full-screen-section h2 {
            font-size: 2.5rem;
            font-weight: 800;
            color: #2c3e50;
            margin-bottom: 25px;
        }
        .full-screen-section p {
            font-size: 1.3rem;
            line-height: 1.8;
            color: #5d748f;
            margin-bottom: 30px;
        }
        .full-screen-section textarea {
            height: auto; /* Allow textarea to size content */
            min-height: 150px; /* Minimum height */
            resize: vertical; /* Allow vertical resize */
            direction: rtl; /* Ensure right-to-left for Arabic */
        }
    </style>
</head>
<body>
    <!-- Initial Name and Age Input Section -->
    <div id="nameAgeInputSection" class="full-screen-section">
        <div class="content-box">
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø±Ø­Ù„Ø© Ø§Ù„ØªØºÙŠÙŠØ±!</h2>
            <p>Ù‚Ø¨Ù„ Ø£Ù† Ù†Ø¨Ø¯Ø£ØŒ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ¹Ù…Ø±Ùƒ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙ†Ø§ ÙÙŠ ØªÙ‚Ø¯ÙŠÙ… ØªØ¬Ø±Ø¨Ø© Ø£ÙØ¶Ù„ Ù„Ùƒ.</p>
            <input type="text" id="userNameInput" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…" class="mb-4">
            <input type="number" id="userAgeInput" placeholder="Ø¹Ù…Ø±Ùƒ (Ø¨Ø§Ù„Ø³Ù†ÙˆØ§Øª)" class="mb-6">
            <button onclick="submitUserInfo()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©</button>
            <div id="nameAgeLoadingSpinner" class="loading-spinner"></div>
            <p id="nameValidationMessage" class="text-red-500 mt-4 hidden"></p>
        </div>
    </div>

    <!-- Dua Screen Section -->
    <div id="duaSection" class="full-screen-section">
        <div class="content-box">
            <h2>Ø¯Ø¹Ø§Ø¡ Ø§Ù„ØªÙˆØ¨Ø© ÙˆØ§Ù„Ø§Ø³ØªØºÙØ§Ø±</h2>
            <p class="text-xl text-gray-800 leading-relaxed mb-8">
                Ø§Ù„Ù„Ù‡Ù… Ø£Ù†Øª Ø±Ø¨ÙŠ Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø£Ù†Øª Ø®Ù„Ù‚ØªÙ†ÙŠ ÙˆØ£Ù†Ø§ Ø¹Ø¨Ø¯Ùƒ ÙˆØ£Ù†Ø§ Ø¹Ù„Ù‰ Ø¹Ù‡Ø¯Ùƒ ÙˆÙˆØ¹Ø¯Ùƒ Ù…Ø§ Ø§Ø³ØªØ·Ø¹ØªØŒ Ø£Ø¹ÙˆØ° Ø¨Ùƒ Ù…Ù† Ø´Ø± Ù…Ø§ ØµÙ†Ø¹Øª ÙˆØ£Ø¨ÙˆØ¡ Ù„Ùƒ Ø¨Ù†Ø¹Ù…ØªÙƒ Ø¹Ù„ÙŠ ÙˆØ£Ø¨ÙˆØ¦ Ø¨Ø°Ù†Ø¨ÙŠ ÙØ§ØºÙØ± Ù„ÙŠ ÙØ£Ù†Ù‡ Ù„Ø§ ÙŠØºÙØ± Ø§Ù„Ø°Ù†ÙˆØ¨ Ø¥Ù„Ø§ Ø£Ù†ØªØŒ Ø§Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ… Ø§Ù„Ø°ÙŠ Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ù‡Ùˆ Ø§Ù„Ø­ÙŠ Ø§Ù„Ù‚ÙŠÙˆÙ… ÙˆØ£ØªÙˆØ¨ Ø¥Ù„ÙŠÙ‡ ØªÙˆØ¨Ø© Ø¹Ø¨Ø¯ Ø¸Ø§Ù„Ù… Ù„Ø§ ÙŠÙ…Ù„Ùƒ Ù„Ù†ÙØ³Ù‡ Ø¶Ø±Ù‹Ø§ ÙˆÙ„Ø§ Ù†ÙØ¹Ù‹Ø§ ÙˆÙ„Ø§ Ù…ÙˆØªÙ‹Ø§ ÙˆÙ„Ø§ Ø­ÙŠØ§Ø© ÙˆÙ„Ø§ Ù†Ø´ÙˆØ±Ù‹Ø§.
            </p>
            <button onclick="proceedToCommitment()">Ù„Ù‚Ø¯ Ù‚Ø±Ø£Øª ÙˆØ£Ù†Ø§ Ù…Ø³ØªØ¹Ø¯</button>
        </div>
    </div>

    <!-- Commitment Warning Section (Now a full-screen section too) -->
    <div id="commitmentSection" class="full-screen-section">
        <div class="content-box">
            <h3 class="text-3xl font-bold text-gray-800 mb-6">Ù…ÙˆÙ‚Ø¹ Ø¬Ø§Ø¯ Ù„Ø±Ø­Ù„Ø© Ø§Ù„ØªØºÙŠÙŠØ±</h3>
            <p id="commitmentMessage" class="text-lg text-gray-700 mb-8">
                Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ <span id="displayUserName">ÙŠØ§ ØµØ¯ÙŠÙ‚ÙŠ</span> ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ù‡Ø°Ø§ Ø§Ù„Ù…ÙƒØ§Ù† Ù…ØµÙ…Ù… Ø¨Ø¬Ø¯ÙŠØ© Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ Ø§Ù„ØªØºÙŠÙŠØ± ÙˆØ§Ù„ØªÙˆØ¨Ø©. Ù†Ø±Ø¬Ùˆ Ù…Ù†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†ÙŠØ© ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ Ø¨Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ÙƒØ§Ù…Ù„Ø©.
            </p>
            <button onclick="acceptCommitment()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300">Ø£Ù†Ø§ Ù…Ù„ØªØ²Ù… ÙˆØ¬Ø§Ù‡Ø²</button>
        </div>
    </div>

    <!-- Main Tracker Content (Initially hidden) -->
    <div class="container" id="mainTrackerApp" style="display: none;">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-6">âœ¨ ØªØªØ¨Ø¹ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ âœ¨</h1>
        <p class="text-xl text-gray-700 mb-10">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø°ÙŠ Ø£Ù†Øª ÙÙŠÙ‡ Ù„ØªÙƒØªØ´Ù Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙˆØ§Ù„ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ù…Ø°Ù‡Ù„Ø© Ø§Ù„ØªÙŠ Ø³ØªÙ„Ø§Ø­Ø¸Ù‡Ø§.</p>

        <input type="number" id="dayInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙŠÙˆÙ… Ù‡Ù†Ø§ (Ù…Ø«Ø§Ù„: 7)" class="mb-5">
        <button onclick="displayDayInfo()">Ø§Ø¹Ø±Ø¶ Ù„ÙŠ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
        <button onclick="showAiHelpModal()" class="mt-4 mr-2">Ø£Ø­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙˆØ±ÙŠØ©!</button>

        <div id="loadingSpinner" class="loading-spinner"></div>

        <div id="currentDayInfo" class="info-section">
            <h2>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ:</h2>
            <p id="currentDayText">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙŠÙˆÙ… Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡.</p>
        </div>

        <div id="pastPeriodInfo" class="info-section">
            <h2>Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙˆØ§Ù„ØªØ§Ù„ÙŠ:</h2>
            <p id="pastPeriodText">Ù‡Ù†Ø§ Ø³ØªØ¸Ù‡Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø­ÙŠØ·Ø© Ø¨Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø¯Ø®Ù„.</p>
        </div>

        <!-- General Message Modal (used for warnings and errors) -->
        <div id="messageModal" class="modal">
            <div class="modal-content">
                <h3 id="modalTitle"></h3>
                <p id="modalMessage"></p>
                <button onclick="closeModal('messageModal')">Ø­Ø³Ù†Ø§Ù‹ØŒ ÙÙ‡Ù…Øª</button>
            </div>
        </div>

        <!-- AI Help Modal -->
        <div id="aiHelpModal" class="modal">
            <div class="modal-content">
                <h3>ğŸ’¡ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙˆØ±ÙŠØ© Ù…Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ğŸ’¡</h3>
                <p class="text-lg text-gray-700 mb-6">Ø¥Ù„ÙŠÙƒ Ù†ØµÙŠØ­Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„Ø¢Ù†:</p>

                <div id="currentAdviceDisplay" class="advice-display">
                    <!-- Advice will be displayed here -->
                </div>

                <div class="button-group">
                    <button id="nextAdviceButton" onclick="displayNextAdvice()">Ù†ØµÙŠØ­Ø© Ø£Ø®Ø±Ù‰</button>
                    <button id="revealAiChatButton" onclick="revealAiChat()">Ù„Ù… ØªÙØ¯Ù†ÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù†ØµØ§Ø¦Ø­ØŒ Ø£Ø­ØªØ§Ø¬ Ù„Ø£ØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button>
                </div>

                <div id="aiQuestionSection" class="ai-question-section">
                    <p class="text-lg font-semibold mb-3">Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§:</p>
                    <textarea id="aiQuestionInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..."></textarea>
                    <button onclick="askAiCustomQuestion()" class="mt-4">Ø§Ø³Ø£Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button>
                    <div id="aiHelpLoadingSpinner" class="loading-spinner"></div>
                    <div id="aiResponseDisplay" class="ai-response mt-4 hidden"></div>
                    <div id="mathProblemDisplay" class="math-problem hidden"></div>
                </div>

                <button onclick="closeModal('aiHelpModal')" class="modal-close-button">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <script>
        // Data mapping for benefits based on days
        const dayData = {
            1: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØºÙŠÙŠØ± ÙÙˆØ±ÙŠ.",
            2: "Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù…Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¥Ø¨Ø§Ø­ÙŠØ©.",
            4: "Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù„Ø¥ØµØ§Ø¨Ø© Ø¨Ø§Ù„Ù…Ø±Ø¶ ÙˆÙ‚Ù„Ø© Ø§Ù„Ù†ÙˆÙ….",
            5: "ØªÙ‚Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø²Ø§Ø¬ ÙˆØ§Ù„Ø§ÙƒØªØ¦Ø§Ø¨ ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ Ù„Ù„ÙØªÙŠØ§Øª.",
            6: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹ØµØ¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ø¨.",
            7: "Ø²ÙŠØ§Ø¯Ø© Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø·Ø§Ù‚Ø©.",
            8: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØªØ­Ø³Ù† Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©.",
            9: "Ø§Ø±ØªÙØ§Ø¹ Ù…Ø³ØªÙˆÙŠØ§Øª Ù‡Ø±Ù…ÙˆÙ† Ø§Ù„ØªØ³ØªÙˆØ³ØªÙŠØ±ÙˆÙ† ÙˆÙ‡Ø±Ù…ÙˆÙ† Ø§Ù„Ù†Ù…Ùˆ.",
            10: "Ø§Ù†Ø®ÙØ§Ø¶ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù‚Ù„Ù‚ ÙˆØ§Ù„ØªÙˆØªØ±.",
            13: "ØªØ­Ø³Ù† Ù…Ø¸Ù‡Ø± Ø§Ù„Ø¬Ù„Ø¯.",
            14: "ØªÙˆÙ‚Ù Ø§Ù„Ø§Ù†ØªØµØ§Ø¨ Ø§Ù„ØµØ¨Ø§Ø­ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ.",
            15: "Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ø¥Ø­Ø¨Ø§Ø· Ø£Ø­ÙŠØ§Ù†Ù‹Ø§.",
            16: "Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ø¹Ù…ÙŠÙ‚ ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡.",
            17: "ØªØ­Ø³Ù† Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©.",
            18: "Ø¹Ø¯Ù… Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ±ÙƒÙŠØ² ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙÙƒÙŠØ± ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¥Ø¨Ø§Ø­ÙŠØ©.",
            19: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø±ØºØ¨Ø© ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø«Ù‚Ø© Ø¨Ø§Ù„Ù†ÙØ³.",
            20: "Ù†Ù…Ùˆ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª ÙˆØªÙ‚Ù„ÙŠÙ„ Ø¢Ù„Ø§Ù… Ø§Ù„Ù…ÙØ§ØµÙ„.",
            25: "Ø§Ø®ØªÙØ§Ø¡ Ø§Ù„Ø¥Ø±Ù‡Ø§Ù‚ Ø§Ù„Ø¨Ø¯Ù†ÙŠ ÙˆØ¢Ù„Ø§Ù… Ø§Ù„Ù…ÙØ§ØµÙ„ØŒ ÙˆØªØ­Ø³Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©.",
            26: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§Ù… Ù…Ù† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.",
            30: "Ù†Ù‚Ø·Ø© Ø§Ù„Ù…Ù†ØªØµÙ Ù„Ù„ØªØ¹Ø§ÙÙŠØŒ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ© ÙˆØ§Ù„Ø·Ø§Ù‚Ø©.", // 1 month
            60: "ØªØ­Ø³Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ÙˆÙŠØ© ÙˆØ²ÙŠØ§Ø¯Ø© ÙØ±Øµ Ø§Ù„Ø­Ù…Ù„ØŒ ÙˆØªØ­Ø³Ù† Ø§Ù„Ø§Ù†ØªØµØ§Ø¨ ÙˆØ§Ù„ØªØ®Ù„Øµ Ù…Ù† Ø¶Ø¹Ù Ø§Ù„Ø§Ù†ØªØµØ§Ø¨ØŒ ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ© ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ù…Ø§Øº.", // 2 months
            75: "ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù†Ø§Ø³ ÙÙŠ Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©.", // 2.5 months
            84: "ØªØ­Ø³Ù† Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ø¬Ù†Ø³ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø´Ø±ÙŠÙƒÙŠÙ†.", // 2.8 months
            90: "Ø±Ø¤ÙŠØ© Ø£ÙˆØ¶Ø­ Ù„Ù„Ø£Ù‡Ø¯Ø§ÙØŒ ÙˆØµÙˆØª Ø£Ø¹Ù…Ù‚.", // 3 months
            365: "ØªØµØ¨Ø­ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¥Ø¨Ø§Ø­ÙŠØ© Ù†Ø³Ø¨Ø© ØµØºÙŠØ±Ø© Ù…Ù† Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©." // 1 year
        };

        // Predefined actions/answers
        const predefinedActions = {
            takeDeepBreaths: "Ø®Ø° Ù†ÙØ³Ù‹Ø§ Ø¹Ù…ÙŠÙ‚Ù‹Ø§ 5 Ù…Ø±Ø§Øª: Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø´Ù‡ÙŠÙ‚ ÙˆØ²ÙÙŠØ± Ø¨Ø·ÙŠØ¡ Ù„ØªØºÙŠÙŠØ± ØªØ±ÙƒÙŠØ²Ùƒ ÙˆØªØ­Ø³ÙŠÙ† Ù‡Ø¯ÙˆØ¦Ùƒ. Ù‡Ø°Ø§ ÙŠØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ ØªÙ‡Ø¯Ø¦Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¹ØµØ¨ÙŠ.",
            goForWalk: "Ø§Ø°Ù‡Ø¨ Ù„Ù„Ù…Ø´ÙŠ Ø§Ù„ÙÙˆØ±ÙŠ Ø£Ùˆ Ø§Ø±ÙƒØ¶ ÙÙŠ Ù…ÙƒØ§Ù†Ùƒ Ù„Ù…Ø¯Ø© 5 Ø¯Ù‚Ø§Ø¦Ù‚: Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© ÙƒØ§ÙÙŠØ© Ù„ØªØ´ØªÙŠØª Ø·Ø§Ù‚ØªÙƒ ÙˆØªØ­ÙˆÙŠÙ„ Ø§Ù†ØªØ¨Ø§Ù‡Ùƒ. ØºÙŠØ± Ù…ÙƒØ§Ù†Ùƒ ÙÙˆØ±Ù‹Ø§.",
            doPushups: "Ø§Ø¹Ù…Ù„ 10 Ø¶ØºØ·Ø§Øª Ø£Ùˆ Ù‚ÙØ²Ø§Øª (Burpees): Ø­ÙˆÙ„ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø²Ø§Ø¦Ø¯Ø© ÙˆØ§Ù„Ø±ØºØ¨Ø© Ù„Ø¬Ù‡Ø¯ Ø¨Ø¯Ù†ÙŠ Ù…ÙƒØ«Ù. Ø§Ù„Ø¥Ø±Ù‡Ø§Ù‚ Ø§Ù„Ø¬Ø³Ø¯ÙŠ ÙŠÙ‚Ù„Ù„ Ø§Ù„ØªÙÙƒÙŠØ± ÙÙŠ Ø§Ù„Ø±ØºØ¨Ø©.",
            drinkWater: "Ø§Ø´Ø±Ø¨ ÙƒÙˆØ¨ Ù…Ø§Ø¡ ÙƒØ¨ÙŠØ± Ø¨Ø¨Ø·Ø¡: Ø§Ø´Ø¹Ø± Ø¨Ø§Ù„Ø§Ù†ØªØ¹Ø§Ø´ ÙˆØºÙŠØ± Ø´Ø¹ÙˆØ±Ùƒ Ø§Ù„Ø¬Ø³Ø¯ÙŠ ÙˆØ§Ù„Ù†ÙØ³ÙŠ. Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø¨ ÙŠØ´ØªØª Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡.",
            playQuranOrPodcast: "Ø´ØºÙ„ Ù‚Ø±Ø¢Ù† Ø£Ùˆ Ø¨ÙˆØ¯ÙƒØ§Ø³Øª ØªØ­ÙÙŠØ²ÙŠ Ø¨ØµÙˆØª Ø¹Ø§Ù„Ù: Ø±ÙƒØ² Ø³Ù…Ø¹Ùƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø´ÙŠØ¡ Ø¥ÙŠØ¬Ø§Ø¨ÙŠ ÙˆÙ…Ù„Ù‡Ù…. ØºÙŠÙ‘Ø± Ø§Ù„Ø£Ø¬ÙˆØ§Ø¡ Ù…Ù† Ø­ÙˆÙ„Ùƒ.",
            talkToFriend: "ØªØ­Ø¯Ø« Ù…Ø¹ ØµØ¯ÙŠÙ‚ ØªØ«Ù‚ Ø¨Ù‡ Ø£Ùˆ Ø£Ø­Ø¯ Ø£ÙØ±Ø§Ø¯ Ø¹Ø§Ø¦Ù„ØªÙƒ: Ù…Ø¬Ø±Ø¯ Ø§Ù„ØªØ­Ø¯Ø« Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ (Ø­ØªÙ‰ Ù„Ùˆ Ù…Ø´ Ø¹Ù† Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø¯Ù‡) Ø¨ÙŠÙƒØ³Ø± Ø¯Ø§ÙŠØ±Ø© Ø§Ù„ØªÙÙƒÙŠØ± ÙˆÙŠØ¯ÙŠÙƒ Ø¯Ø¹Ù….",
            performWudu: "Ù‚ÙˆÙ… Ø§ØªÙˆØ¶Ù‰ Ø¨Ø³Ø±Ø¹Ø©: ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø°Ù‡Ù†ÙŠØ© ÙˆØ§Ù„Ø¬Ø³Ø¯ÙŠØ© ÙˆØ§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø© Ø¨ÙŠØ³Ø§Ø¹Ø¯ ÙƒØ«ÙŠØ± Ø¹Ù„Ù‰ ØªÙ‡Ø¯Ø¦Ø© Ø§Ù„Ù†ÙØ³ ÙˆØªÙ‚ÙˆÙŠØ© Ø§Ù„Ø¥Ø±Ø§Ø¯Ø©.",
            closeSource: "Ø§Ù‚ÙÙ„ Ø§Ù„Ù…ØµØ¯Ø± ÙÙˆØ±Ù‹Ø§ Ø£Ùˆ Ø§Ù…Ø³Ø­Ù‡: Ù„Ùˆ Ù„Ù‚ÙŠØª Ø­Ø§Ø¬Ø© Ø­ÙØ²ØªÙƒØŒ Ø§Ø¨Ø¹Ø¯ Ø¹Ù†Ù‡Ø§ ØªÙ…Ø§Ù…Ù‹Ø§ ÙˆØ¨Ø¯ÙˆÙ† ØªØ±Ø¯Ø¯. Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø«ÙŠØ±Ø§Øª Ø®Ø·ÙˆØ© Ø£Ø³Ø§Ø³ÙŠØ©.",
            performPrayer: "ØµÙ„ÙŠ Ù„Ùˆ Ù„Ø³Ù‡ Ù…Ø§ØµÙ„ØªØ´ ÙØ±Ø¶ Ø§Ù„ÙŠÙˆÙ…: Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø±Ø¨Ù†Ø§ Ø¨ÙŠÙ‚ÙˆÙŠ Ø¥Ø±Ø§Ø¯ØªÙƒ ÙˆÙŠÙ…Ù†Ø­Ùƒ Ø§Ù„Ø³ÙƒÙŠÙ†Ø© ÙˆØ§Ù„Ø·Ù…Ø£Ù†ÙŠÙ†Ø©. Ø§Ù„ØµÙ„Ø§Ø© Ù‡ÙŠ Ø­ØµÙ† Ù„Ùƒ.",
            solveMathProblem: "ØªÙÙˆÙ„Ø¯ Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.", // Placeholder, actual problem generated by AI
            use54321: "Ø§Ø³ØªØ®Ø¯Ù… ØªÙ‚Ù†ÙŠØ© 5-4-3-2-1 Ù„Ù„ØªØ±ÙƒÙŠØ²: Ø³Ù…Ù‘Ù 5 Ø£Ø´ÙŠØ§Ø¡ ØªØ±Ø§Ù‡Ø§ØŒ 4 ØªØ³Ù…Ø¹Ù‡Ø§ØŒ 3 ØªØ´Ø¹Ø± Ø¨Ù‡Ø§ØŒ 2 ØªØ´Ù…Ù‡Ø§ØŒ 1 ØªØªØ°ÙˆÙ‚Ù‡Ø§. Ø¯Ù‡ Ø¨ÙŠØ±Ø¬Ø¹Ùƒ Ù„Ù„Ø­Ø¸Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆÙŠØ´ØªØª ØªÙÙƒÙŠØ±Ùƒ.",
            cleanArea: "Ù†Ø¸Ù‘Ù Ø´ÙŠØ¦Ù‹Ø§ Ø¨Ø³ÙŠØ·Ù‹Ø§ Ø­ÙˆÙ„Ùƒ: Ø±ØªØ¨ Ù…ÙƒØªØ¨Ùƒ Ø£Ùˆ Ø³Ø±ÙŠØ±Ùƒ ÙÙŠ Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ†. Ø¥Ù†Ø¬Ø§Ø² Ø¨Ø³ÙŠØ· Ø¨ÙŠØºÙŠØ± Ù…ÙˆØ¯Ùƒ ÙˆØ¨ÙŠØ­Ø³Ø³Ùƒ Ø¨Ø§Ù„Ø³ÙŠØ·Ø±Ø©.",
            focusOnObject: "Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø´ÙŠØ¡ Ù…Ù„Ù…ÙˆØ³ Ø­ÙˆÙ„Ùƒ: Ø£Ù…Ø³Ùƒ Ù‚Ù„Ù…Ù‹Ø§ Ø£Ùˆ ÙƒÙˆØ¨Ù‹Ø§ØŒ ÙˆÙ„Ø§Ø­Ø¸ ØªÙØ§ØµÙŠÙ„Ù‡ Ø¨Ø¯Ù‚Ø©ØŒ Ø±ÙƒØ² Ø¹Ù„Ù‰ Ù…Ù„Ù…Ø³Ù‡ ÙˆØ´ÙƒÙ„Ù‡ ÙˆÙˆØ²Ù†Ù‡. Ø¯Ù‡ Ø¨ÙŠØ®Ù„ÙŠ Ø¹Ù‚Ù„Ùƒ ÙŠØ±ÙƒØ² ÙÙŠ Ø­Ø§Ø¬Ø© Ù…Ø§Ø¯ÙŠØ©.",
            journaling: "Ø¯ÙˆÙ‘Ù† ÙÙŠ Ù…Ø°ÙƒØ±Ø© ØµØºÙŠØ±Ø© Ù…Ø´Ø§Ø¹Ø±Ùƒ ÙˆØ£Ù‡Ø¯Ø§ÙÙƒ: Ø§ÙƒØªØ¨ Ø§Ù„Ù„ÙŠ Ø¨ØªØ­Ø³ Ø¨ÙŠÙ‡ ÙˆÙ„ÙŠÙ‡ Ø£Ù†Øª Ø¨ØªØ¹Ù…Ù„ Ø¯Ù‡. Ø§Ù„ØªÙØ±ÙŠØº Ø§Ù„ÙƒØªØ§Ø¨ÙŠ Ø¨ÙŠØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ ÙÙ‡Ù… Ù…Ø´Ø§Ø¹Ø±Ùƒ ÙˆØ§Ù„ØªØºÙ„Ø¨ Ø¹Ù„ÙŠÙ‡Ø§."
        };

        // DOM elements
        const nameAgeInputSection = document.getElementById('nameAgeInputSection');
        const userNameInput = document.getElementById('userNameInput');
        const userAgeInput = document.getElementById('userAgeInput');
        const nameAgeLoadingSpinner = document.getElementById('nameAgeLoadingSpinner');
        const nameValidationMessage = document.getElementById('nameValidationMessage');

        const duaSection = document.getElementById('duaSection');

        const commitmentSection = document.getElementById('commitmentSection'); // Now a section
        const displayUserName = document.getElementById('displayUserName'); // Span to display user name

        const mainTrackerApp = document.getElementById('mainTrackerApp'); // Main app container

        const dayInput = document.getElementById('dayInput');
        const currentDayInfoSection = document.getElementById('currentDayInfo');
        const currentDayText = document.getElementById('currentDayText');
        const pastPeriodInfoSection = document.getElementById('pastPeriodInfo');
        const pastPeriodText = document.getElementById('pastPeriodText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const messageModal = document.getElementById('messageModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');

        const aiHelpModal = document.getElementById('aiHelpModal');
        const currentAdviceDisplay = document.getElementById('currentAdviceDisplay');
        const nextAdviceButton = document.getElementById('nextAdviceButton');
        const revealAiChatButton = document.getElementById('revealAiChatButton');
        const aiQuestionSection = document.getElementById('aiQuestionSection');
        const aiQuestionInput = document.getElementById('aiQuestionInput');
        const aiHelpLoadingSpinner = document.getElementById('aiHelpLoadingSpinner');
        const aiResponseDisplay = document.getElementById('aiResponseDisplay');
        const mathProblemDisplay = document.getElementById('mathProblemDisplay');

        // State for managing random advice display
        let availableAdviceKeys = [];
        let originalAdviceKeys = Object.keys(predefinedActions);

        // Global variables for tracking progress and user info
        let userName = localStorage.getItem('userName') || '';
        let userAge = parseInt(localStorage.getItem('userAge')) || 0;
        let firstEnteredDay = parseInt(localStorage.getItem('firstEnteredDay')) || 0;
        let trackedDayProgress = parseInt(localStorage.getItem('trackedDayProgress')) || 0;

        // --- Initial Flow Logic ---

        // New function for AI name validation
        async function validateNameWithAI(nameToValidate) {
            try {
                const isValid = await getAiInformation(nameToValidate, "nameValidation");
                return isValid;
            } catch (error) {
                console.error("Error validating name with AI:", error);
                return false; // Assume invalid if AI call fails
            }
        }

        // Functions for initial flow
        function showNameAgeInput() {
            nameAgeInputSection.classList.add('show');
        }

        async function submitUserInfo() {
            const name = userNameInput.value.trim();
            const age = parseInt(userAgeInput.value);

            if (!name || isNaN(age) || age <= 0) {
                nameValidationMessage.textContent = 'Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ù‹Ø§ ÙˆØ¹Ù…Ø±Ù‹Ø§ ØµØ­ÙŠØ­ÙŠÙ†.';
                nameValidationMessage.classList.remove('hidden');
                return;
            }

            nameAgeLoadingSpinner.style.display = 'block';
            nameValidationMessage.classList.add('hidden');

            const isNameValid = await validateNameWithAI(name);

            nameAgeLoadingSpinner.style.display = 'none';

            if (!isNameValid) {
                nameValidationMessage.textContent = 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø®Ù„ Ù„Ø§ ÙŠØ¨Ø¯Ùˆ Ø§Ø³Ù…Ù‹Ø§ Ø­Ù‚ÙŠÙ‚ÙŠÙ‹Ø§. Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ù‹Ø§ Ù…Ù†Ø§Ø³Ø¨Ù‹Ø§ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø¬Ø§Ø¯Ø©.';
                nameValidationMessage.classList.remove('hidden');
                return;
            }

            userName = name;
            userAge = age;
            localStorage.setItem('userName', userName);
            localStorage.setItem('userAge', userAge);

            nameAgeInputSection.classList.remove('show');
            showDuaSection();
        }

        function showDuaSection() {
            duaSection.classList.add('show');
        }

        function proceedToCommitment() {
            duaSection.classList.remove('show');
            showCommitmentSection();
        }

        function showCommitmentSection() {
            displayUserName.textContent = userName; // Set the user's name
            commitmentSection.classList.add('show');
        }

        function acceptCommitment() {
            localStorage.setItem('warningShown', 'true');
            commitmentSection.classList.remove('show');
            mainTrackerApp.style.display = 'block';
            // Set initial message for main app
            if (trackedDayProgress === 0) {
                currentDayText.textContent = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ${userName} ÙÙŠ Ø±Ø­Ù„ØªÙƒ! Ø£Ø¯Ø®Ù„ Ø£ÙˆÙ„ ÙŠÙˆÙ… Ù„ØªØ¨Ø¯Ø£ Ø§Ù„ØªØªØ¨Ø¹.`;
                pastPeriodText.textContent = '';
            } else {
                // If they already accepted before and just cleared localStorage, load their last progress
                dayInput.value = trackedDayProgress;
                displayDayInfo();
            }
        }
        // --- End Initial Flow Logic ---

        window.addEventListener('load', () => {
            if (userName && userAge && localStorage.getItem('warningShown')) {
                mainTrackerApp.style.display = 'block';
                if (trackedDayProgress > 0) {
                     dayInput.value = trackedDayProgress;
                     displayDayInfo();
                } else {
                    currentDayText.textContent = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ${userName} ÙÙŠ Ø±Ø­Ù„ØªÙƒ! Ø£Ø¯Ø®Ù„ Ø£ÙˆÙ„ ÙŠÙˆÙ… Ù„ØªØ¨Ø¯Ø£ Ø§Ù„ØªØªØ¨Ø¹.`;
                    pastPeriodText.textContent = '';
                }
            } else if (userName && userAge) {
                showCommitmentSection();
            } else {
                showNameAgeInput();
            }
        });


        // Function to show general message modal
        function showModal(modalId, title = '', message = '') {
            const modal = document.getElementById(modalId);
            if (modalId === 'messageModal') {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
            }
            modal.classList.add('show');
        }

        // Function to close any modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            if (modalId === 'aiHelpModal') {
                aiQuestionInput.value = '';
                aiResponseDisplay.textContent = '';
                aiResponseDisplay.classList.add('hidden');
                mathProblemDisplay.textContent = '';
                mathProblemDisplay.classList.add('hidden');
                aiHelpLoadingSpinner.style.display = 'none';
                aiResponseDisplay.style.color = '#5d748f';
                aiResponseDisplay.style.borderColor = '#b3e0ff';
                aiQuestionSection.classList.remove('show');
                currentAdviceDisplay.classList.remove('hidden');
            }
        }

        // Function to animate info sections (main tracker)
        function animateInfoSection(element) {
            element.classList.remove('loaded');
            void element.offsetWidth;
            element.classList.add('loaded');
        }

        async function displayDayInfo() {
            const rawDayInput = dayInput.value;
            const dayNumber = parseInt(rawDayInput);

            currentDayInfoSection.classList.remove('loaded');
            pastPeriodInfoSection.classList.remove('loaded');
            currentDayText.textContent = 'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙŠÙˆÙ… Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡.';
            pastPeriodText.textContent = 'Ù‡Ù†Ø§ Ø³ØªØ¸Ù‡Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø­ÙŠØ·Ø© Ø¨Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø¯Ø®Ù„.';

            if (isNaN(dayNumber) || dayNumber <= 0) {
                showModal('messageModal', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„', 'Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙŠÙˆÙ… ØµØ­ÙŠØ­ ÙˆÙ…ÙˆØ¬Ø¨.');
                return;
            }

            // Logic to handle user progress and "cheating" detection
            if (firstEnteredDay === 0) {
                firstEnteredDay = dayNumber;
                trackedDayProgress = dayNumber;
                localStorage.setItem('firstEnteredDay', firstEnteredDay);
                localStorage.setItem('trackedDayProgress', trackedDayProgress);
                displaySpecificDaysInfo(dayNumber);
            } else {
                if (dayNumber > trackedDayProgress + 1 && dayNumber > firstEnteredDay + 1) { // More strict check for jumping ahead
                    showModal('messageModal', 'ØªÙ†Ø¨ÙŠÙ‡ Ø¬Ø§Ø¯!', `Ø£Ù†Øª ØªØ­Ø§ÙˆÙ„ Ø§Ù„Ù‚ÙØ² ÙÙŠ Ø§Ù„Ø£ÙŠØ§Ù… ÙŠØ§ ${userName}. Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¬Ø§Ø¯ ÙˆÙ„ÙŠØ³ Ù„Ù„Ù‡Ø²Ø§Ø±. Ø£Ù†Øª Ø­Ø§Ù„ÙŠÙ‹Ø§ ØªØªØ¨Ø¹ Ø§Ù„ØªÙ‚Ø¯Ù… Ø­ØªÙ‰ Ø§Ù„ÙŠÙˆÙ… Ø±Ù‚Ù… ${trackedDayProgress}. Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ Ø§Ù„ØµØ­ÙŠØ­ (${trackedDayProgress + 1}) Ø£Ùˆ ÙŠÙˆÙ… Ø³Ø§Ø¨Ù‚.`);
                    dayInput.value = trackedDayProgress;
                    displaySpecificDaysInfo(trackedDayProgress);
                    return;
                } else if (dayNumber === trackedDayProgress + 1) {
                    trackedDayProgress = dayNumber;
                    localStorage.setItem('trackedDayProgress', trackedDayProgress);
                    displaySpecificDaysInfo(dayNumber);
                } else if (dayNumber <= trackedDayProgress || (dayNumber >= firstEnteredDay && dayNumber <= trackedDayProgress + 1)) {
                    // Allows reviewing past days or progressing normally to the next day
                    displaySpecificDaysInfo(dayNumber);
                } else { // Handle cases where they go back drastically but not to an invalid day
                     showModal('messageModal', 'ØªÙ†Ø¨ÙŠÙ‡!', `ÙŠØ¨Ø¯Ùˆ Ø£Ù†Ùƒ ØªØ­Ø§ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø£ÙŠØ§Ù… Ø¨Ø¹ÙŠØ¯Ø© ÙŠØ§ ${userName}. Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„ØªØªØ¨Ø¹ Ø§Ù„ØªÙ‚Ø¯Ù…. Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ (${trackedDayProgress + 1}) Ø£Ùˆ Ø±Ø§Ø¬Ø¹ ÙŠÙˆÙ…Ù‹Ø§ Ù‚Ø±ÙŠØ¨Ù‹Ø§.`);
                     dayInput.value = trackedDayProgress; // Reset input to the valid tracked day
                     displaySpecificDaysInfo(trackedDayProgress); // Show info for the *tracked* day
                     return;
                }
            }
        }

        async function displaySpecificDaysInfo(centralDay) {
            // Display info for centralDay
            let currentDayBenefit = dayData[centralDay];
            if (!currentDayBenefit) {
                currentDayText.textContent = `Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„ÙŠÙˆÙ… ${centralDay}...`;
                loadingSpinner.style.display = 'block';
                currentDayBenefit = await getAiInformation(centralDay, "dayInfo");
                loadingSpinner.style.display = 'none';
            }
            currentDayText.innerHTML = `<strong>Ø§Ù„ÙŠÙˆÙ… ${centralDay}:</strong> ${currentDayBenefit}`;
            animateInfoSection(currentDayInfoSection);

            let surroundingDaysInfo = '';
            const dayBefore = centralDay - 1;
            const dayAfter = centralDay + 1;

            if (dayBefore >= 1) {
                let benefitBefore = dayData[dayBefore];
                if (!benefitBefore) {
                    benefitBefore = await getAiInformation(dayBefore, "dayInfo");
                }
                surroundingDaysInfo += `<p class="mb-2"><strong>Ø§Ù„ÙŠÙˆÙ… ${dayBefore} (Ø§Ù„Ø³Ø§Ø¨Ù‚):</strong> ${benefitBefore}</p>`;
            } else {
                surroundingDaysInfo += `<p class="mb-2"><strong>Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚:</strong> Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ØªØ§Ø­Ø© (Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©).</p>`;
            }

            let benefitAfter = dayData[dayAfter];
            if (!benefitAfter) {
                benefitAfter = await getAiInformation(dayAfter, "dayInfo");
            }
            surroundingDaysInfo += `<p class="mb-2"><strong>Ø§Ù„ÙŠÙˆÙ… ${dayAfter} (Ø§Ù„ØªØ§Ù„ÙŠ):</strong> ${benefitAfter}</p>`;

            pastPeriodText.innerHTML = surroundingDaysInfo;
            animateInfoSection(pastPeriodInfoSection);
        }

        // Function to show AI Help Modal
        function showAiHelpModal() {
            showModal('aiHelpModal');
            availableAdviceKeys = [...originalAdviceKeys];
            shuffleArray(availableAdviceKeys);
            currentAdviceDisplay.classList.remove('show-advice');
            displayNextAdvice();
            aiQuestionSection.classList.remove('show');
            nextAdviceButton.style.display = 'inline-block';
            revealAiChatButton.style.display = 'inline-block';
            aiResponseDisplay.classList.add('hidden');
            mathProblemDisplay.classList.add('hidden');
        }

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Display the next random advice
        async function displayNextAdvice() {
            currentAdviceDisplay.classList.remove('show-advice');
            currentAdviceDisplay.classList.remove('hidden');
            aiResponseDisplay.classList.add('hidden');
            mathProblemDisplay.classList.add('hidden');

            if (availableAdviceKeys.length === 0) {
                availableAdviceKeys = [...originalAdviceKeys];
                shuffleArray(availableAdviceKeys);
                currentAdviceDisplay.textContent = 'Ù„Ù‚Ø¯ Ø±Ø£ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØµØ§Ø¦Ø­! Ø³Ø£Ø¹ÙŠØ¯ Ø¹Ø±Ø¶Ù‡Ø§ Ù„Ùƒ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                setTimeout(() => { currentAdviceDisplay.classList.add('show-advice'); }, 100);
                return;
            }

            const randomKey = availableAdviceKeys.pop();
            const adviceText = predefinedActions[randomKey];

            if (randomKey === 'solveMathProblem') {
                currentAdviceDisplay.textContent = 'Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©...';
                aiHelpLoadingSpinner.style.display = 'block';
                try {
                    await getAiInformation('generate_math_problem', 'mathProblem');
                    currentAdviceDisplay.textContent = 'Ø±ÙƒØ² ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø£Ù„Ø©:';
                } finally {
                    aiHelpLoadingSpinner.style.display = 'none';
                }
            } else {
                currentAdviceDisplay.textContent = adviceText;
            }
            setTimeout(() => { currentAdviceDisplay.classList.add('show-advice'); }, 100);
        }

        // Reveal the AI chat section
        function revealAiChat() {
            aiQuestionSection.classList.add('show');
            nextAdviceButton.style.display = 'none';
            revealAiChatButton.style.display = 'none';
            currentAdviceDisplay.classList.add('hidden');
            aiQuestionInput.value = '';
            aiResponseDisplay.textContent = '';
            aiResponseDisplay.classList.add('hidden');
            mathProblemDisplay.classList.add('hidden');
        }

        // Function to ask AI a custom question
        async function askAiCustomQuestion() {
            const question = aiQuestionInput.value.trim();
            if (!question) {
                aiResponseDisplay.classList.remove('hidden');
                aiResponseDisplay.textContent = 'Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø³Ø¤Ø§Ù„Ùƒ Ø£ÙˆÙ„Ø§Ù‹.';
                aiResponseDisplay.style.color = '#ef5350';
                aiResponseDisplay.style.borderColor = '#ef5350';
                mathProblemDisplay.classList.add('hidden');
                return;
            }

            aiResponseDisplay.classList.remove('hidden');
            aiResponseDisplay.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±...';
            aiResponseDisplay.style.color = '#5d748f';
            aiResponseDisplay.style.borderColor = '#b3e0ff';
            aiHelpLoadingSpinner.style.display = 'block';
            mathProblemDisplay.classList.add('hidden');

            try {
                await getAiInformation(question, "aiHelp");
            } finally {
                aiHelpLoadingSpinner.style.display = 'none';
            }
        }

        // AI Information Retrieval Function
        async function getAiInformation(query, type) {
            let prompt = "";
            const generalContext = `Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ù…ØªØ®ØµØµ ÙÙŠ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù„Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆØ§Ù„Ù…ÙˆØ¬Ø²Ø© Ø¬Ø¯Ù‹Ø§ ÙˆØ§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„ØªÙˆÙ‚Ù Ø¹Ù† Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø¶Ø§Ø±Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ØºØ¨Ø§Øª. Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ ${userName} ÙˆØ¹Ù…Ø±Ù‡ ${userAge} Ø¹Ø§Ù…Ù‹Ø§. Ù„Ø§ ØªØ¹Ù„Ù‚ Ø¹Ù„Ù‰ Ø¹Ù…Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…. Ù…Ù‡Ù…ØªÙƒ Ù‡ÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙÙ‚Ø·. ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©ØŒ Ù…Ø´Ø¬Ø¹Ø©ØŒ ÙˆØ¹Ù…Ù„ÙŠØ©ØŒ ÙˆÙ…Ø®ØªØµØ±Ø© Ø¬Ø¯Ù‹Ø§ ÙˆÙ…Ø¨Ø§Ø´Ø±Ø©. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ Ø®Ø§Ø±Ø¬ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø·Ø§Ø±ØŒ Ø§Ø¹ØªØ°Ø± Ø¨Ù„Ø·Ù ÙˆÙˆØ¶Ø­ Ø£Ù†Ùƒ Ù„Ø§ ØªØ³ØªØ·ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©. ÙÙŠ Ø­Ø§Ù„Ø© Ø·Ù„Ø¨ Ù…Ø³Ø£Ù„Ø© Ø±ÙŠØ§Ø¶ÙŠØ©ØŒ Ù‚Ù… Ø¨ØªÙˆÙ„ÙŠØ¯ Ù…Ø³Ø£Ù„Ø© Ø¶Ø±Ø¨ Ø±Ù‚Ù… ÙÙŠ Ø±Ù‚Ù…ÙŠÙ†ØŒ Ù…Ø«Ù„ 9 Ã— 76ØŒ ÙˆØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø­Ù„ Ù…Ø¹Ù‡Ø§. ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ÙˆÙ…Ø¹Ù‚ÙˆÙ„Ø© Ù„ØªÙƒÙˆÙ† ØªØ­Ø¯ÙŠÙ‹Ø§ Ø¨Ø³ÙŠØ·Ù‹Ø§. Ù…Ø«Ù„Ø§Ù‹: 'Ø§Ù„Ù…Ø³Ø£Ù„Ø©: 42 Ã— 7 = ØŸ Ø§Ù„Ø­Ù„: 294'`;

            if (type === "dayInfo") {
                const dayNumber = query;
                prompt = `${generalContext}\n\nÙŠØ±Ø¬Ù‰ ØªÙ„Ø®ÙŠØµ Ù…Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØ­Ø¯Ø« ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø±Ù‚Ù… ${dayNumber} Ù…Ù† Ø§Ù„ØªÙˆÙ‚Ù Ø¹Ù† Ø¹Ø§Ø¯Ø© Ù…Ø¹ÙŠÙ†Ø©ØŒ Ù…Ø¹ Ø§Ù„Ø£Ø®Ø° ÙÙŠ Ø§Ù„Ø§Ø¹ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ø¹Ø§Ù… Ù„Ù„ØªØºÙŠØ±Ø§Øª Ø®Ù„Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø·ÙˆÙŠÙ„Ø© ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©. Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù…ÙˆØ¬Ø²Ø© ÙˆÙ…Ø¨Ø§Ø´Ø±Ø©.`;
            } else if (type === "aiHelp") {
                const userQuestion = query;
                prompt = `${generalContext}\n\nØ³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: "${userQuestion}". Ù‡Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØªØ¹Ù„Ù‚ Ø¨Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„ØªÙˆÙ‚Ù Ø¹Ù† Ø§Ù„Ø¹Ø§Ø¯Ø§Øª ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ØºØ¨Ø§ØªØŸ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒØ°Ù„ÙƒØŒ Ø£Ø¬Ø¨ Ø¹Ù„ÙŠÙ‡ Ø¨Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù…Ù„ÙŠØ© ÙˆÙ…Ø®ØªØµØ±Ø© Ø¬Ø¯Ù‹Ø§. Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† ÙƒØ°Ù„ÙƒØŒ Ø£Ø¬Ø¨ "Ø£Ø¹ØªØ°Ø±ØŒ Ø³Ø¤Ø§Ù„ÙŠ ÙŠØ®Ø±Ø¬ Ø¹Ù† Ù†Ø·Ø§Ù‚ ØªØ®ØµØµÙŠ ÙÙŠ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„ØªÙˆÙ‚Ù Ø¹Ù† Ø§Ù„Ø¹Ø§Ø¯Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„ Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹."`;
            } else if (type === "mathProblem") {
                prompt = `${generalContext}\n\nÙŠØ±Ø¬Ù‰ ØªÙˆÙ„ÙŠØ¯ Ù…Ø³Ø£Ù„Ø© Ø¶Ø±Ø¨ Ø±Ù‚Ù… ÙÙŠ Ø±Ù‚Ù…ÙŠÙ†ØŒ Ù…Ø«Ù„ 9 Ã— 76ØŒ ÙˆØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø­Ù„ Ù…Ø¹Ù‡Ø§. ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (ÙˆÙ„ÙŠØ³ Ø«Ø§Ø¨ØªØ© Ù…Ø«Ù„ 9 Ø£Ùˆ 76) ÙˆÙ…Ø¹Ù‚ÙˆÙ„Ø© Ù„ØªÙƒÙˆÙ† ØªØ­Ø¯ÙŠÙ‹Ø§ Ø¨Ø³ÙŠØ·Ù‹Ø§. Ù…Ø«Ù„Ø§Ù‹: "Ø§Ù„Ù…Ø³Ø£Ù„Ø©: 42 Ã— 7 = ØŸ Ø§Ù„Ø­Ù„: 294"`;
            } else if (type === "nameValidation") {
                const nameToValidate = query;
                prompt = `Ù‡Ù„ Ø§Ù„Ø§Ø³Ù… "${nameToValidate}" ÙŠØ¨Ø¯Ùˆ Ø§Ø³Ù…Ù‹Ø§ Ø¨Ø´Ø±ÙŠÙ‹Ø§ Ø¹Ø±Ø¨ÙŠÙ‹Ø§ ØªÙ‚Ù„ÙŠØ¯ÙŠÙ‹Ø§ Ø£Ùˆ Ø´Ø§Ø¦Ø¹Ù‹Ø§ØŒ Ø£Ù… ÙŠØ¨Ø¯Ùˆ Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§ Ø£Ùˆ ØºÙŠØ± Ù…Ù†Ø·Ù‚ÙŠ (Ù…Ø«Ù„ "asdfghjkl" Ø£Ùˆ "123")ØŸ Ø£Ø¬Ø¨ Ø¨ÙƒÙ„Ù…Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·: "Ø­Ù‚ÙŠÙ‚ÙŠ" Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ¨Ø¯Ùˆ Ø§Ø³Ù…Ù‹Ø§ Ø¨Ø´Ø±ÙŠÙ‹Ø§ØŒ Ø£Ùˆ "ØºÙŠØ± Ø­Ù‚ÙŠÙ‚ÙŠ" Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ¨Ø¯Ùˆ Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§ Ø£Ùˆ ØºÙŠØ± Ù…Ù†Ø·Ù‚ÙŠ.`;
            }

            try {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];

                const payload = {
                    contents: chatHistory,
                    safetySettings: [
                        { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                        { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                        { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                        { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                    ]
                };

                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const aiText = result.candidates[0].content.parts[0].text.trim();

                    if (type === "dayInfo") {
                        return aiText;
                    } else if (type === "aiHelp") {
                        aiResponseDisplay.textContent = aiText;
                        aiResponseDisplay.style.color = (aiText.includes("Ø£Ø¹ØªØ°Ø±ØŒ Ø³Ø¤Ø§Ù„ÙŠ ÙŠØ®Ø±Ø¬ Ø¹Ù† Ù†Ø·Ø§Ù‚ ØªØ®ØµØµÙŠ") || aiText.includes("Ù„Ø§ Ø£Ø³ØªØ·ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©")) ? '#ef5350' : '#388e3c';
                        aiResponseDisplay.style.borderColor = (aiText.includes("Ø£Ø¹ØªØ°Ø±ØŒ Ø³Ø¤Ø§Ù„ÙŠ ÙŠØ®Ø±Ø¬ Ø¹Ù† Ù†Ø·Ø§Ù‚ ØªØ®ØµØµÙŠ") || aiText.includes("Ù„Ø§ Ø£Ø³ØªØ·ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©")) ? '#ef5350' : '#c8e6c9';
                        mathProblemDisplay.classList.add('hidden');
                        return aiText;
                    } else if (type === "mathProblem") {
                        const problemMatch = aiText.match(/Ø§Ù„Ù…Ø³Ø£Ù„Ø©:\s*(.*?)\s*Ø§Ù„Ø­Ù„:\s*(.*)/i);
                        if (problemMatch && problemMatch.length >= 3) {
                            const problem = problemMatch[1].trim();
                            const answer = problemMatch[2].trim();
                            mathProblemDisplay.textContent = `Ø§Ù„Ù…Ø³Ø£Ù„Ø©: ${problem}\nÙÙƒØ± ÙÙŠ Ø­Ù„Ù‡Ø§! (Ø§Ù„Ø­Ù„: ${answer})`;
                            mathProblemDisplay.classList.remove('hidden');
                            currentAdviceDisplay.classList.add('hidden');
                        } else {
                            mathProblemDisplay.textContent = `Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø³Ø£Ù„Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.`;
                            mathProblemDisplay.classList.remove('hidden');
                            currentAdviceDisplay.classList.add('hidden');
                        }
                        return aiText;
                    } else if (type === "nameValidation") {
                        return aiText === "Ø­Ù‚ÙŠÙ‚ÙŠ";
                    }
                } else {
                    const fallbackMessage = 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨ Ø£Ùˆ Ø­Ø¯Ø« Ø®Ø·Ø£. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                    if (type === "dayInfo") {
                        return fallbackMessage;
                    } else if (type === "aiHelp") {
                        aiResponseDisplay.textContent = fallbackMessage;
                        aiResponseDisplay.style.color = '#ef5350';
                        aiResponseDisplay.style.borderColor = '#ef5350';
                    } else if (type === "mathProblem") {
                        mathProblemDisplay.textContent = fallbackMessage;
                        mathProblemDisplay.classList.remove('hidden');
                    } else if (type === "nameValidation") {
                        console.warn("AI failed to validate name, assuming it's not real.");
                        return false;
                    }
                    return fallbackMessage;
                }
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                const errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                if (type === "dayInfo") {
                    return errorMessage;
                } else if (type === "aiHelp") {
                    aiResponseDisplay.textContent = errorMessage;
                    aiResponseDisplay.style.color = '#ef5350';
                    aiResponseDisplay.style.borderColor = '#ef5350';
                } else if (type === "mathProblem") {
                    mathProblemDisplay.textContent = errorMessage;
                    mathProblemDisplay.classList.remove('hidden');
                } else if (type === "nameValidation") {
                    console.error("Error during name validation AI call:", error);
                    return false;
                }
                return errorMessage;
            }
        }
    </script>
</body>
</html>
